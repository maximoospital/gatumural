<!DOCTYPE html>
<html>
  <head>
    <title>Gatumural</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//cdn.muicss.com/mui-0.10.3/css/mui.min.css" rel="stylesheet" type="text/css" />
    <script src="//cdn.muicss.com/mui-0.10.3/js/mui.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      canvas {
        display: block;
      }
    #dibujo {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url('fondo.png');
        background-size: cover;
        background-position: center;
        z-index: -1;
    }
        .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 1;
        transition: opacity 1s ease-out;
        z-index: 9999;
        }

        .loading-circle {
        border: 4px solid #fff;
        border-top: 4px solid transparent;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        }

        @keyframes spin {
        0% {
            transform: rotate(0);
        }
        100% {
            transform: rotate(360deg);
        }
        }

        .contenido {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        .dialog {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #fff; /* Dialogue background color */
        border: 2px solid #000; /* Dialogue border */
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        padding: 20px;
        z-index: 9998;
        }

        .dialog-content {
        text-align: center;
        }

        .dialog button {
        margin-top: 10px;
        padding: 6px 12px;
        background-color: #008080; /* Dialogue button background color */
        color: #fff; /* Dialogue button text color */
        border: none;
        cursor: pointer;
        border-radius: 4px;
        }

        .dialog button:hover {
        background-color: #006666; /* Dialogue button background color on hover */
        }
      #controls {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: #FA6900;
        border-radius: 5px;
        color: white;
        padding: .5rem;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        box-shadow: 1px 5px 10px 1px rgba(100,100,100,2.45);
      }

      #controls label {
        display: block;
        margin-bottom: 5px;
      }

      #screenshot-dialog {
        display: none;
        position: fixed;
        top: 50px;
        left: 50%;
        transform: translateX(-50%);
        width: 80%;
        max-height: 80%;
        background-color: #fff;
        border: 1px solid #ccc;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: auto;
        z-index: 999;
        padding: 10px;
      }

      #screenshot-dialog img {
        display: block;
        width: 100%;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <div class="loading-overlay" id="loadingOverlay">
        <img style="width:15%; position: absolute; top:40%; cursor: pointer;" src="logo.png" alt="Click Me" class="Logo" onclick="openAboutDialog()">
        <div class="loading-circle">
        </div>
      </div>
      <script>
        window.addEventListener('load', () => {
          const loadingOverlay = document.getElementById('loadingOverlay');
          setTimeout(() => {
            loadingOverlay.style.opacity = 0;
            setTimeout(() => {
              loadingOverlay.style.display = 'none';
            }, 1000); 
          }, 2000);
        });
        // Detect if this is the user's first visit utilizing a cookie called 'firstVisit'. 
        // If it is, show the about dialog and store a cookie in the user's browser for future visits.
        // Execute the function firstVisit() when the page loads
        function openAboutDialog() {
  const aboutDialog = document.getElementById('aboutDialog');
  aboutDialog.style.display = 'block';
}

function closeAboutDialog() {
  const aboutDialog = document.getElementById('aboutDialog');
  aboutDialog.style.display = 'none';
}
function getCookie(name) {
  const cookies = document.cookie.split(';');
  for (let i = 0; i < cookies.length; i++) {
    const cookie = cookies[i].trim();
    if (cookie.startsWith(name + '=')) {
      return cookie.substring(name.length + 1);
    }
  }
  return null;
}

function setCookie(name, value, days) {
  const date = new Date();
  date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
  const expires = 'expires=' + date.toUTCString();
  document.cookie = name + '=' + value + ';' + expires + ';path=/';
}

window.addEventListener('DOMContentLoaded', () => {
  const firstVisit = getCookie('firstVisit');
  if (!firstVisit) {
    openAboutDialog();
    setCookie('firstVisit', 'true', 365); // Set the firstVisit cookie for 365 days
  }
});

      </script>
        
    <div class="dialog" id="aboutDialog">
        <div class="dialog-content">
          <img style="width:50%; position: static; cursor: pointer;" src="logo.png" alt="Click Me" class="Logo" onclick="openAboutDialog()">
          <h3>Bienvenido a <b>Gatumural!</b></h3>
          <p><b>Dibuja</b> y deja tu firma en esta estatua del gato <b>mas</b> querido por los espectadores!</p>
          <p>Podes elegir un <b>color y tamaño</b> de fibra!</p>
          <p>Eso si, recorda que tenes un <b>limite</b> que podes extender con una donacion ;)</p>
          <h4><b>texto por razones legales</b></h4>
          <p>De ninguna forma pretende este sitio autorizar o promover el acto de vandalismo. <br>Tampoco pretende este sitio violar los derechos de autor de la creacion referida.<br> Gatumural es un experimento interactivo con animos de humor sobre eventos actuales. <br> Gaturro es un personaje de Cristian "Nik" Dzwonik @ 2023.</p>
          <p>Existen altas chances de que el sitio se caiga o trabe porque soy medio corki.</p>
          <p>X si pasa eso, <a href="http://twitter.com/Gatumural" target="_blank">Seguinos aca para updates</a></p>
          <button onclick="closeAboutDialog()" class="mui-btn mui-btn--primary" style="padding: 0px 26px !important">Cerrar</button>
        </div>
      </div>    
    <div class="contenido">
        <div class="mui-panel" style="position:absolute; top:10px; left:10px">
            <div class="mui-container-fluid">
                <div class="mui-row">
                    <div class="mui-col-xs-12" style="font-size: 24px; padding: 0px !important; margin: 0px !important; margin-left: -2px !important; ">Controles</div>
                </div>
                <div class="mui-row">
                  <div class="mui-col-xs-6" style="width: 70% !important; padding: 0px !important; margin: 0px !important;">Color:</div>
                  <div class="mui-col-xs-6" style="width: 10% !important; padding: 0px !important; margin: 0px !important;"> <input type="color" id="colorPicker" style="padding: 0px;"/>                  </div>
                </div>
                <div class="mui-row">
                    <div class="mui-col-xs-6" style="width: 28% !important; padding: 0px !important; margin: 0px !important;">Tamaño:</div>
                    <div class="mui-col-xs-6" style="padding: 0px !important; margin: 0px !important;"><input type="range" style="margin: 2px;" id="sizePicker" min="1" max="20" value="5" /></div>
                  </div>
                  <div class="mui-row">
                    <div class="mui-col-xs-6" style="width: 28% !important; padding: 0px !important; margin: 0px !important;">Fuerza:</div>
                    <div class="mui-col-xs-6" style="padding: 0px !important; margin: 0px !important;"><input type="range" style="margin: 2px;" id="transparencyPicker" min="1" max="20" value="5" /></div>
                  </div>
                  <div class="mui-row">
                    <div class="mui-col-xs-12" style="padding: 0px !important;">  <button id="captureButton" class="mui-btn mui-btn--primary" style="width: 98%;">Sacar captura</button></div>
                </div>
                <script>
                  document.getElementById('captureButton').addEventListener('click', () => {
  const elementToCapture = document.getElementById('dibujo');

  // Create a canvas element to draw the captured image
  const canvas = document.createElement('canvas');
  canvas.width = elementToCapture.offsetWidth;
  canvas.height = elementToCapture.offsetHeight;

  // Draw the captured element on the canvas
  html2canvas(elementToCapture).then((canvas) => {
    // Convert the canvas to a data URL
    const dataUrl = canvas.toDataURL('image/png');

    // Create a temporary anchor link to trigger the download
    const downloadLink = document.createElement('a');
    downloadLink.href = dataUrl;
    downloadLink.download = 'Gatumural-' + Date.now() + '.png'; // Change the filename as needed

    // Programmatically trigger the download
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
  });
});

                </script>
                  </div>       
            </div>   
    </div>       
    <div id="dibujo">
      <img style="width:15%; position: absolute; top:1%; cursor: pointer; top: 1%; left: 0; right: 0;  margin: 0 auto;" src="logo.png" alt="Click Me" class="Logo" onclick="openAboutDialog()">
      <canvas id="canvas"></canvas>
    </div>   
        <script src="/socket.io/socket.io.js"></script>
        <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const colorPicker = document.getElementById('colorPicker');
        const sizePicker = document.getElementById('sizePicker');
        const transparencyPicker = document.getElementById('transparencyPicker');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        colorPicker.addEventListener('change', () => {
            ctx.strokeStyle = colorPicker.value;
        });

        sizePicker.addEventListener('input', () => {
            ctx.lineWidth = sizePicker.value;
        });

        transparencyPicker.addEventListener('input', () => {
            ctx.lineWidth = transparencyPicker.value;
        });

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        const socket = io();
        socket.on('draw', (data) => {
            drawLine(data);
        });

        socket.on('drawingHistory', (data) => {
            data.forEach((line) => drawLine(line));
        });

        function drawLine(line) {
            ctx.beginPath();
            ctx.moveTo(line.lastX, line.lastY);
            ctx.lineTo(line.x, line.y);
            ctx.strokeStyle = line.color;
            ctx.lineWidth = line.size;
            ctx.stroke();
            ctx.closePath();
        }

        function startDrawing(e) {
            isDrawing = true;
            lastX = e.clientX;
            lastY = e.clientY;
        }

        function draw(e) {
            if (!isDrawing) return;

            const line = {
            lastX,
            lastY,
            x: e.clientX,
            y: e.clientY,
            color: ctx.strokeStyle,
            size: ctx.lineWidth,
            };

            drawLine(line);
            socket.emit('draw', line);

            lastX = e.clientX;
            lastY = e.clientY;
        }

        function stopDrawing() {
            isDrawing = false;
        }

        </script>
    </div>
  </body>
